# Maintainer: Vicki Pfau <vi@endrift.com>
# Maintainer: Jeremy Whiting <jeremy.whiting@collabora.com>

pkgname=steamos-manager
_srctag=v25.1.1
pkgver=${_srctag##v}
pkgrel=0
pkgdesc='SteamOS Manager daemon for running various system management tasks'
arch=('x86_64')
url='https://store.steampowered.com/steamos/'
license=('MIT')
depends=('dbus'
         'steamos-networking-tools'  # For steamos-wifi-set-backend
         'systemd'
         'wireless_tools')  # For iwconfig
optdepends=('jupiter-hw-support: jupiter support'  # Needed for jupiter-get-als-gain, jupiter-biosupdate, steamos-format-device, steamos-trim-devices
            'jupiter-dock-updater-bin: jupiter dock updater'  # Needed for jupiter-dock-updater
            'steamos-customizations-jupiter: jupiter support'  # Needed for steamos-factory-reset-config
            'steamos-log-submitter: ftrace logging'
            'plasma-remotecontrollers: CEC wake support'
            'wakehook: CEC wake support')
makedepends=('git' 'cargo' 'holo-rust-packaging-tools')
source=("$pkgname-$pkgver::git+https://github.com/evlav/$pkgname.git#tag=${_srctag}"
        'addr2line-0.24.2.tar.gz::https://crates.io/api/v1/crates/addr2line/0.24.2/download'
        'adler2-2.0.0.tar.gz::https://crates.io/api/v1/crates/adler2/2.0.0/download'
        'aho-corasick-1.1.3.tar.gz::https://crates.io/api/v1/crates/aho-corasick/1.1.3/download'
        'anstyle-1.0.10.tar.gz::https://crates.io/api/v1/crates/anstyle/1.0.10/download'
        'anyhow-1.0.95.tar.gz::https://crates.io/api/v1/crates/anyhow/1.0.95/download'
        'async-broadcast-0.7.2.tar.gz::https://crates.io/api/v1/crates/async-broadcast/0.7.2/download'
        'async-recursion-1.1.1.tar.gz::https://crates.io/api/v1/crates/async-recursion/1.1.1/download'
        'async-trait-0.1.85.tar.gz::https://crates.io/api/v1/crates/async-trait/0.1.85/download'
        'autocfg-1.4.0.tar.gz::https://crates.io/api/v1/crates/autocfg/1.4.0/download'
        'backtrace-0.3.74.tar.gz::https://crates.io/api/v1/crates/backtrace/0.3.74/download'
        'bitflags-2.8.0.tar.gz::https://crates.io/api/v1/crates/bitflags/2.8.0/download'
        'bytes-1.9.0.tar.gz::https://crates.io/api/v1/crates/bytes/1.9.0/download'
        'cfg_aliases-0.2.1.tar.gz::https://crates.io/api/v1/crates/cfg_aliases/0.2.1/download'
        'cfg-if-1.0.0.tar.gz::https://crates.io/api/v1/crates/cfg-if/1.0.0/download'
        'clap-4.5.27.tar.gz::https://crates.io/api/v1/crates/clap/4.5.27/download'
        'clap_builder-4.5.27.tar.gz::https://crates.io/api/v1/crates/clap_builder/4.5.27/download'
        'clap_derive-4.5.24.tar.gz::https://crates.io/api/v1/crates/clap_derive/4.5.24/download'
        'clap_lex-0.7.4.tar.gz::https://crates.io/api/v1/crates/clap_lex/0.7.4/download'
        'concurrent-queue-2.5.0.tar.gz::https://crates.io/api/v1/crates/concurrent-queue/2.5.0/download'
        'config-0.14.1.tar.gz::https://crates.io/api/v1/crates/config/0.14.1/download'
        'const-random-0.1.18.tar.gz::https://crates.io/api/v1/crates/const-random/0.1.18/download'
        'const-random-macro-0.1.16.tar.gz::https://crates.io/api/v1/crates/const-random-macro/0.1.16/download'
        'crossbeam-utils-0.8.21.tar.gz::https://crates.io/api/v1/crates/crossbeam-utils/0.8.21/download'
        'crunchy-0.2.3.tar.gz::https://crates.io/api/v1/crates/crunchy/0.2.3/download'
        'dlv-list-0.5.2.tar.gz::https://crates.io/api/v1/crates/dlv-list/0.5.2/download'
        'either-1.13.0.tar.gz::https://crates.io/api/v1/crates/either/1.13.0/download'
        'endi-1.1.0.tar.gz::https://crates.io/api/v1/crates/endi/1.1.0/download'
        'enumflags2-0.7.11.tar.gz::https://crates.io/api/v1/crates/enumflags2/0.7.11/download'
        'enumflags2_derive-0.7.11.tar.gz::https://crates.io/api/v1/crates/enumflags2_derive/0.7.11/download'
        'equivalent-1.0.1.tar.gz::https://crates.io/api/v1/crates/equivalent/1.0.1/download'
        'errno-0.3.10.tar.gz::https://crates.io/api/v1/crates/errno/0.3.10/download'
        'event-listener-5.4.0.tar.gz::https://crates.io/api/v1/crates/event-listener/5.4.0/download'
        'event-listener-strategy-0.5.3.tar.gz::https://crates.io/api/v1/crates/event-listener-strategy/0.5.3/download'
        'fastrand-2.3.0.tar.gz::https://crates.io/api/v1/crates/fastrand/2.3.0/download'
        'futures-core-0.3.31.tar.gz::https://crates.io/api/v1/crates/futures-core/0.3.31/download'
        'futures-sink-0.3.31.tar.gz::https://crates.io/api/v1/crates/futures-sink/0.3.31/download'
        'futures-task-0.3.31.tar.gz::https://crates.io/api/v1/crates/futures-task/0.3.31/download'
        'futures-util-0.3.31.tar.gz::https://crates.io/api/v1/crates/futures-util/0.3.31/download'
        'getrandom-0.2.15.tar.gz::https://crates.io/api/v1/crates/getrandom/0.2.15/download'
        'gimli-0.31.1.tar.gz::https://crates.io/api/v1/crates/gimli/0.31.1/download'
        'hashbrown-0.14.5.tar.gz::https://crates.io/api/v1/crates/hashbrown/0.14.5/download'
        'hashbrown-0.15.2.tar.gz::https://crates.io/api/v1/crates/hashbrown/0.15.2/download'
        'heck-0.5.0.tar.gz::https://crates.io/api/v1/crates/heck/0.5.0/download'
        'hermit-abi-0.3.9.tar.gz::https://crates.io/api/v1/crates/hermit-abi/0.3.9/download'
        'hex-0.4.3.tar.gz::https://crates.io/api/v1/crates/hex/0.4.3/download'
        'indexmap-2.7.1.tar.gz::https://crates.io/api/v1/crates/indexmap/2.7.1/download'
        'inotify-0.11.0.tar.gz::https://crates.io/api/v1/crates/inotify/0.11.0/download'
        'inotify-sys-0.1.5.tar.gz::https://crates.io/api/v1/crates/inotify-sys/0.1.5/download'
        'io-lifetimes-1.0.11.tar.gz::https://crates.io/api/v1/crates/io-lifetimes/1.0.11/download'
        'itertools-0.13.0.tar.gz::https://crates.io/api/v1/crates/itertools/0.13.0/download'
        'lazy_static-1.5.0.tar.gz::https://crates.io/api/v1/crates/lazy_static/1.5.0/download'
        'libc-0.2.169.tar.gz::https://crates.io/api/v1/crates/libc/0.2.169/download'
        'libudev-sys-0.1.4.tar.gz::https://crates.io/api/v1/crates/libudev-sys/0.1.4/download'
        'linux-raw-sys-0.4.15.tar.gz::https://crates.io/api/v1/crates/linux-raw-sys/0.4.15/download'
        'matchers-0.1.0.tar.gz::https://crates.io/api/v1/crates/matchers/0.1.0/download'
        'memchr-2.7.4.tar.gz::https://crates.io/api/v1/crates/memchr/2.7.4/download'
        'memoffset-0.9.1.tar.gz::https://crates.io/api/v1/crates/memoffset/0.9.1/download'
        'minimal-lexical-0.2.1.tar.gz::https://crates.io/api/v1/crates/minimal-lexical/0.2.1/download'
        'miniz_oxide-0.8.3.tar.gz::https://crates.io/api/v1/crates/miniz_oxide/0.8.3/download'
        'mio-1.0.3.tar.gz::https://crates.io/api/v1/crates/mio/1.0.3/download'
        'nix-0.29.0.tar.gz::https://crates.io/api/v1/crates/nix/0.29.0/download'
        'nom-7.1.3.tar.gz::https://crates.io/api/v1/crates/nom/7.1.3/download'
        'num_enum-0.7.3.tar.gz::https://crates.io/api/v1/crates/num_enum/0.7.3/download'
        'num_enum_derive-0.7.3.tar.gz::https://crates.io/api/v1/crates/num_enum_derive/0.7.3/download'
        'object-0.36.7.tar.gz::https://crates.io/api/v1/crates/object/0.36.7/download'
        'once_cell-1.20.2.tar.gz::https://crates.io/api/v1/crates/once_cell/1.20.2/download'
        'ordered-multimap-0.7.3.tar.gz::https://crates.io/api/v1/crates/ordered-multimap/0.7.3/download'
        'ordered-stream-0.2.0.tar.gz::https://crates.io/api/v1/crates/ordered-stream/0.2.0/download'
        'parking-2.2.1.tar.gz::https://crates.io/api/v1/crates/parking/2.2.1/download'
        'pathdiff-0.2.3.tar.gz::https://crates.io/api/v1/crates/pathdiff/0.2.3/download'
        'pin-project-lite-0.2.16.tar.gz::https://crates.io/api/v1/crates/pin-project-lite/0.2.16/download'
        'pin-utils-0.1.0.tar.gz::https://crates.io/api/v1/crates/pin-utils/0.1.0/download'
        'pkg-config-0.3.31.tar.gz::https://crates.io/api/v1/crates/pkg-config/0.3.31/download'
        'proc-macro2-1.0.93.tar.gz::https://crates.io/api/v1/crates/proc-macro2/1.0.93/download'
        'proc-macro-crate-3.2.0.tar.gz::https://crates.io/api/v1/crates/proc-macro-crate/3.2.0/download'
        'quick-xml-0.36.2.tar.gz::https://crates.io/api/v1/crates/quick-xml/0.36.2/download'
        'quote-1.0.38.tar.gz::https://crates.io/api/v1/crates/quote/1.0.38/download'
        'regex-1.11.1.tar.gz::https://crates.io/api/v1/crates/regex/1.11.1/download'
        'regex-automata-0.1.10.tar.gz::https://crates.io/api/v1/crates/regex-automata/0.1.10/download'
        'regex-automata-0.4.9.tar.gz::https://crates.io/api/v1/crates/regex-automata/0.4.9/download'
        'regex-syntax-0.6.29.tar.gz::https://crates.io/api/v1/crates/regex-syntax/0.6.29/download'
        'regex-syntax-0.8.5.tar.gz::https://crates.io/api/v1/crates/regex-syntax/0.8.5/download'
        'rustc-demangle-0.1.24.tar.gz::https://crates.io/api/v1/crates/rustc-demangle/0.1.24/download'
        'rust-ini-0.20.0.tar.gz::https://crates.io/api/v1/crates/rust-ini/0.20.0/download'
        'rustix-0.38.44.tar.gz::https://crates.io/api/v1/crates/rustix/0.38.44/download'
        'rustversion-1.0.19.tar.gz::https://crates.io/api/v1/crates/rustversion/1.0.19/download'
        'serde-1.0.217.tar.gz::https://crates.io/api/v1/crates/serde/1.0.217/download'
        'serde_derive-1.0.217.tar.gz::https://crates.io/api/v1/crates/serde_derive/1.0.217/download'
        'serde_repr-0.1.19.tar.gz::https://crates.io/api/v1/crates/serde_repr/0.1.19/download'
        'serde_spanned-0.6.8.tar.gz::https://crates.io/api/v1/crates/serde_spanned/0.6.8/download'
        'sharded-slab-0.1.7.tar.gz::https://crates.io/api/v1/crates/sharded-slab/0.1.7/download'
        'signal-hook-registry-1.4.2.tar.gz::https://crates.io/api/v1/crates/signal-hook-registry/1.4.2/download'
        'slab-0.4.9.tar.gz::https://crates.io/api/v1/crates/slab/0.4.9/download'
        'socket2-0.5.8.tar.gz::https://crates.io/api/v1/crates/socket2/0.5.8/download'
        'static_assertions-1.1.0.tar.gz::https://crates.io/api/v1/crates/static_assertions/1.1.0/download'
        'strum-0.26.3.tar.gz::https://crates.io/api/v1/crates/strum/0.26.3/download'
        'strum_macros-0.26.4.tar.gz::https://crates.io/api/v1/crates/strum_macros/0.26.4/download'
        'syn-2.0.96.tar.gz::https://crates.io/api/v1/crates/syn/2.0.96/download'
        'tempfile-3.15.0.tar.gz::https://crates.io/api/v1/crates/tempfile/3.15.0/download'
        'thread_local-1.1.8.tar.gz::https://crates.io/api/v1/crates/thread_local/1.1.8/download'
        'tiny-keccak-2.0.2.tar.gz::https://crates.io/api/v1/crates/tiny-keccak/2.0.2/download'
        'tokio-1.43.0.tar.gz::https://crates.io/api/v1/crates/tokio/1.43.0/download'
        'tokio-macros-2.5.0.tar.gz::https://crates.io/api/v1/crates/tokio-macros/2.5.0/download'
        'tokio-stream-0.1.17.tar.gz::https://crates.io/api/v1/crates/tokio-stream/0.1.17/download'
        'tokio-util-0.7.13.tar.gz::https://crates.io/api/v1/crates/tokio-util/0.7.13/download'
        'toml-0.8.19.tar.gz::https://crates.io/api/v1/crates/toml/0.8.19/download'
        'toml_datetime-0.6.8.tar.gz::https://crates.io/api/v1/crates/toml_datetime/0.6.8/download'
        'toml_edit-0.22.22.tar.gz::https://crates.io/api/v1/crates/toml_edit/0.22.22/download'
        'tracing-0.1.41.tar.gz::https://crates.io/api/v1/crates/tracing/0.1.41/download'
        'tracing-attributes-0.1.28.tar.gz::https://crates.io/api/v1/crates/tracing-attributes/0.1.28/download'
        'tracing-core-0.1.33.tar.gz::https://crates.io/api/v1/crates/tracing-core/0.1.33/download'
        'tracing-subscriber-0.3.19.tar.gz::https://crates.io/api/v1/crates/tracing-subscriber/0.3.19/download'
        'udev-0.9.3.tar.gz::https://crates.io/api/v1/crates/udev/0.9.3/download'
        'uds_windows-1.1.0.tar.gz::https://crates.io/api/v1/crates/uds_windows/1.1.0/download'
        'unicode-ident-1.0.14.tar.gz::https://crates.io/api/v1/crates/unicode-ident/1.0.14/download'
        'wasi-0.11.0+wasi-snapshot-preview1.tar.gz::https://crates.io/api/v1/crates/wasi/0.11.0+wasi-snapshot-preview1/download'
        'winapi-0.3.9.tar.gz::https://crates.io/api/v1/crates/winapi/0.3.9/download'
        'winapi-i686-pc-windows-gnu-0.4.0.tar.gz::https://crates.io/api/v1/crates/winapi-i686-pc-windows-gnu/0.4.0/download'
        'winapi-x86_64-pc-windows-gnu-0.4.0.tar.gz::https://crates.io/api/v1/crates/winapi-x86_64-pc-windows-gnu/0.4.0/download'
        'windows_aarch64_gnullvm-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_gnullvm/0.48.5/download'
        'windows_aarch64_gnullvm-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_gnullvm/0.52.6/download'
        'windows_aarch64_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_msvc/0.48.5/download'
        'windows_aarch64_msvc-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_msvc/0.52.6/download'
        'windows_i686_gnu-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnu/0.48.5/download'
        'windows_i686_gnu-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnu/0.52.6/download'
        'windows_i686_gnullvm-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnullvm/0.52.6/download'
        'windows_i686_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_msvc/0.48.5/download'
        'windows_i686_msvc-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_i686_msvc/0.52.6/download'
        'windows-sys-0.48.0.tar.gz::https://crates.io/api/v1/crates/windows-sys/0.48.0/download'
        'windows-sys-0.52.0.tar.gz::https://crates.io/api/v1/crates/windows-sys/0.52.0/download'
        'windows-sys-0.59.0.tar.gz::https://crates.io/api/v1/crates/windows-sys/0.59.0/download'
        'windows-targets-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows-targets/0.48.5/download'
        'windows-targets-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows-targets/0.52.6/download'
        'windows_x86_64_gnu-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnu/0.48.5/download'
        'windows_x86_64_gnu-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnu/0.52.6/download'
        'windows_x86_64_gnullvm-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnullvm/0.48.5/download'
        'windows_x86_64_gnullvm-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnullvm/0.52.6/download'
        'windows_x86_64_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_msvc/0.48.5/download'
        'windows_x86_64_msvc-0.52.6.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_msvc/0.52.6/download'
        'winnow-0.6.24.tar.gz::https://crates.io/api/v1/crates/winnow/0.6.24/download'
        'xdg-2.5.2.tar.gz::https://crates.io/api/v1/crates/xdg/2.5.2/download'
        'xdg-home-1.3.0.tar.gz::https://crates.io/api/v1/crates/xdg-home/1.3.0/download'
        'zbus-5.3.0.tar.gz::https://crates.io/api/v1/crates/zbus/5.3.0/download'
        'zbus_macros-5.3.0.tar.gz::https://crates.io/api/v1/crates/zbus_macros/5.3.0/download'
        'zbus_names-4.1.1.tar.gz::https://crates.io/api/v1/crates/zbus_names/4.1.1/download'
        'zbus_xml-5.0.2.tar.gz::https://crates.io/api/v1/crates/zbus_xml/5.0.2/download'
        'zvariant-5.2.0.tar.gz::https://crates.io/api/v1/crates/zvariant/5.2.0/download'
        'zvariant_derive-5.2.0.tar.gz::https://crates.io/api/v1/crates/zvariant_derive/5.2.0/download'
        'zvariant_utils-3.1.0.tar.gz::https://crates.io/api/v1/crates/zvariant_utils/3.1.0/download')
sha256sums=('SKIP'
            'dfbe277e56a376000877090da837660b4427aad530e3028d44e0bffe4f89a1c1'
            '512761e0bb2578dd7380c6baaa0f4ce03e84f95e960231d1dec8bf4d7d6e2627'
            '8e60d3430d3a69478ad0993f19238d2df97c507009a52b3c10addcd7f6bcb916'
            '55cc3b69f167a1ef2e161439aa98aed94e6028e5f9a59be9a6ffb47aef1651f9'
            '34ac096ce696dc2fcabef30516bb13c0a68a11d30131d3df6f04711467681b04'
            '435a87a52755b8f27fcf321ac4f04b2802e337c8c4872923137471ec39c37532'
            '3b43422f69d8ff38f95f1b2bb76517c91589a924d1559a0e935d7c8ce0274c11'
            '3f934833b4b7233644e5848f235df3f57ed8c80f1528a26c3dfa13d2147fa056'
            'ace50bade8e6234aa140d9a2f552bbee1db4d353f69b8217bc503490fc1a9f26'
            '8d82cb332cdfaed17ae235a638438ac4d4839913cc2af585c3c6746e8f8bee1a'
            '8f68f53c83ab957f72c32642f3868eec03eb974d1fb82e453128456482613d36'
            '325918d6fe32f23b19878fe4b34794ae41fc19ddbe53b10571a4874d44ffd39b'
            '613afe47fcd5fac7ccf1db93babcb082c5994d996f20b8b159f2ad1658eb5724'
            'baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd'
            '769b0145982b4b48713e01ec42d61614425f27b7058bda7180a3a41f30104796'
            '1b26884eb4b57140e4d2d93652abfa49498b938b3c9179f9fc487b0acc3edad7'
            '54b755194d6389280185988721fffba69495eed5ee9feeee9a599b53db80318c'
            'f46ad14479a25103f283c0f10005961cf086d8dc42205bb44c46ac563475dca6'
            '4ca0197aee26d1ae37445ee532fefce43251d24cc7c166799f4d46817f1d3973'
            '68578f196d2a33ff61b27fae256c3164f65e36382648e30666dde05b8cc9dfdf'
            '87e00182fe74b066627d63b85fd550ac2998d4b0bd86bfed477a0ae4c7c71359'
            'f9d839f2a20b0aee515dc581a6172f2321f96cab76c1a38a4c584a194955390e'
            'd0a5c400df2834b80a4c3327b3aad3a4c4cd4de0629063962b03235697506a28'
            '43da5946c66ffcc7745f48db692ffbb10a83bfe0afd96235c5c2a4fb23994929'
            '442039f5147480ba31067cb00ada1adae6892028e40e45fc5de7b7df6dcc1b5f'
            '60b1af1c220855b6ceac025d3f6ecdd2b7c4894bfe9cd9bda4fbb4bc7c0d4cf0'
            'a3d8a32ae18130a3c84dd492d4215c3d913c3b07c6b63c2eb3eb7ff1101ab7bf'
            'ba2f4b465f5318854c6f8dd686ede6c0a9dc67d4b1ac241cf0eb51521a309147'
            'fc4caf64a58d7a6d65ab00639b046ff54399a39f5f2554728895ace4b297cd79'
            '5443807d6dff69373d433ab9ef5378ad8df50ca6298caf15de6e52e24aaf54d5'
            '33d852cb9b869c2a9b3df2f71a3074817f01e1844f839a144f5fcef059a4eb5d'
            '3492acde4c3fc54c845eaab3eed8bd00c7a7d881f78bfc801e43a93dec1331ae'
            '3c3e4e0dd3673c1139bf041f3008816d9cf2946bbfac2945c09e523b8d7b05b2'
            '37909eebbb50d72f9059c3b6d82c0463f2ff062c9e95845c43a6c9c0355411be'
            '05f29059c0c2090612e8d742178b0580d2dc940c837851ad723096f87af6663e'
            'e575fab7d1e0dcb8d0c7bcf9a63ee213816ab51902e6d244a95819acacf1d4f7'
            'f90f7dce0722e95104fcb095585910c0977252f286e354b5e3bd38902cd99988'
            '9fa08315bb612088cc391249efdc3bc77536f16c91f6cf495e6fbe85b20a4a81'
            'c4567c8db10ae91089c99af84c68c38da3ec2f087c3f82960bcdbf3656b6f4d7'
            '07e28edb80900c19c28f1072f2e8aeca7fa06b23cd4169cefe1af5aa3260783f'
            'e5274423e17b7c9fc20b6e7e208532f9b19825d82dfd615708b70edd83df41f1'
            'bf151400ff0baff5465007dd2f3e717f3fe502074ca563069ce3a6629d07b289'
            '2304e00983f87ffb38b55b444b5e3b60a884b5d30c0fca7d82fe33449bbe55ea'
            'd231dfb89cfffdbc30e7fc41579ed6066ad03abda9e567ccafae602b97ec5024'
            '7f24254aa9a54b5c858eaee2f5bccdb46aaf0e486a595ed5fd8f86ba55232a70'
            '8c9c992b02b5b4c94ea26e32fe5bccb7aa7d9f390ab5c1221ff895bc7ea8b652'
            'f37dccff2791ab604f9babef0ba14fbe0be30bd368dc541e2b08d07c8aa908f3'
            'e05c02b5e89bff3b946cedeca278abc628fe811e604f027c45a8aa3cf793d0eb'
            'eae7b9aee968036d54dce06cebaefd919e4472e753296daccd6d344e3e2df0c2'
            '413ee7dfc52ee1a4949ceeb7dbc8a33f2d6c088194d9f922fb8318faf1f01186'
            'bbd2bcb4c963f2ddae06a2efc7e9f3591312473c50c6685e1f298068316e66fe'
            'b5aba8db14291edd000dfcc4d620c7ebfb122c613afb886ca8803fa4e128a20a'
            '3c8469b4a23b962c1396b9b451dda50ef5b283e8dd309d69033475fa9b334324'
            'd26c52dbd32dccf2d10cac7725f8eae5296885fb5703b261f7d0a0739ec807ab'
            '8263075bb86c5a1b1427b5ae862e8889656f126e9f77c484496e8b47cf5c5558'
            '78ca9ab1a0babb1e7d5695e3530886289c18cf2f87ec19a575a0abdce112e3a3'
            '488016bfae457b036d996092f6cb448677611ce4449e970ceaf42695203f218a'
            '68354c5c6bd36d73ff3feceb05efa59b6acb7626617f4962be322a825e61f79a'
            'b8402cab7aefae129c6977bb0ff1b8fd9a04eb5b51efc50a70bea51cda0c7924'
            '2886843bf800fba2e3377cff24abf6379b4c4d5c6681eaf9ea5b0d15090450bd'
            '71e2746dc3a24dd78b3cfcb7be93368c6de9963d30f43a6a73998a9cf4b17b46'
            'd273983c5a657a70a3e8f2a01329822f3b8c8172b73826411a55751e404a0a4a'
            '4e613fc340b2220f734a8595782c551f1250e969d87d3be1ae0579e8d4065179'
            'af1844ef2428cc3e1cb900be36181049ef3d3193c63e43026cfe202983b27a56'
            '62948e14d923ea95ea2c7c86c71013138b66525b86bdc08d2dcc262bdb497b87'
            '1261fe7e33c73b354eab43b1273a57c8f967d0391e80353e51f764ac02cf6775'
            '49203cdcae0030493bad186b28da2fa25645fa276a51b6fec8010d281e02ef79'
            '9aa2b01e1d916879f73a53d01d1d6cee68adbb31d6d9177a8cfce093cced1d50'
            'f38d5652c16fde515bb1ecef450ab0f6a219d619a7274976324d5e377f7dceba'
            'df94ce210e5bc13cb6651479fa48d14f601d9858cfe0467f43ae157023b938d3'
            '3b3cff922bd51709b605d9ead9aa71031d81447142d828eb4a6eba76fe619f9b'
            '8b870d8c151b6f2fb93e84a13146138f05d02ed11c7e7c54f8826aaaf7c9f184'
            '953ec861398dccce10c670dfeaf3ec4911ca479e9c02154b3a215178c5f566f2'
            '60946a68e5f9d28b0dc1c21bb8a97ee7d018a8b322fa57838ba31cc878e22d99'
            '8ecf48c7ca261d60b74ab1a7b20da18bede46776b2e55535cb958eb595c5fa7b'
            'f7649a7b4df05aed9ea7ec6f628c67c9953a43869b8bc50929569b2999d443fe'
            '0e4dccaaaf89514f546c693ddc140f729f958c247918a13380cccc6078391acc'
            'b544ef1b4eac5dc2db33ea63606ae9ffcfac26c1416a2806ae0bf5f56b201191'
            '6c230d73fb8d8c1b9c0b3135c5142a8acee3a0558fb8db5cf1cb65f8d7862132'
            '809e8dc61f6de73b46c85f4c96486310fe304c434cfa43669d7b40f711150908'
            'f162c6dd7b008981e4d40210aca20b4bd0f9b60ca9271061b07f78537722f2e1'
            '2b15c43186be67a4fd63bee50d0303afffcef381492ebe2c5d87f324e1b8815c'
            '719b953e2095829ee67db738b3bfa9fa368c94900df327b3f07fe6e794d2fe1f'
            '3e0698206bcb8882bf2a9ecb4c1e7785db57ff052297085a6efd4fe42302068a'
            'fdb5bc1ae2baa591800df16c9ca78619bf65c0488b41b96ccec5d11220d8c154'
            'f7c45b9784283f1b2e7fb61b42047c2fd678ef0960d4f6f1eba131594cc369d4'
            '02fc4265df13d6fa1d00ecff087228cc0a2b5f3c0e87e258d8b94a156e984c70'
            '5a9bf7cf98d04a2b28aead066b7496853d4779c9cc183c440dbac457641e19a0'
            '6c64451ba24fc7a6a2d60fc75dd9c83c90903b19028d4eff35e88fc1e86564e9'
            '87607cb1398ed59d48732e575a4c28a7a8ebf2454b964fe3f224f2afc07909e1'
            'f40ca3c46823713e0d4209592e8d6e826aa57e928f09752619fc696c499637f6'
            'a9e9e0b4211b72e7b8b6e85c807d36c212bdb33ea8587f7569562a84df5465b1'
            '8f92a496fb766b417c996b9c5e57daf2f7ad3b0bebe1ccfca4856390e3d3bb67'
            'c970269d99b64e60ec3bd6ad27270092a5394c4e309314b18ae3fe575695fbe8'
            'a2eb9349b6444b326872e140eb1cf5e7c522154d69e7a0ffb0fb81c06b37543f'
            '8fec0f0aef304996cf250b31b5a10dee7980c85da9d759361292b8bca5a18f06'
            '4c6bee85a5a24955dc440386795aa378cd9cf82acd5f764469152d2270e581be'
            'd5d0adab1ae378d7f53bdebc67a39f1f151407ef230f0ce2883572f5d8985c80'
            '9a8a559c81686f576e8cd0290cd2a24a2a9ad80c98b3478856500fcbd7acd704'
            '8b9ef9bad013ada3808854ceac7b46812a6465ba368859a37e2100283d2d719c'
            '2c9d3793400a45f954c52e73d068316d76b6f4e36977e3fcebb13a2721e80237'
            '3d61fa4ffa3de412bfea335c6ecff681de2b609ba3c77ef3e00e521813a9ed9e'
            '6e06d43f1345a3bcd39f6a56dbb7dcab2ba47e68e8ac134855e7e2bdbaf8cab8'
            'eca58d7bba4a75707817a2c44174253f9236b2d5fbd055602e9d5c07c139a047'
            'd7fcaa8d55a2bdd6b83ace262b016eca0d79ee02818c5c1bcdf0305114081078'
            'a1ed1f98e3fdc28d6d910e6737ae6ab1a93bf1985935a1193e68f93eeb68d24e'
            '0dd7358ecb8fc2f8d014bf86f6f638ce72ba252a2c3a2572f2a795f1d23efb41'
            '4ae48d6208a266e853d946088ed816055e556cc6028c5e8e2b84d9fa5dd7c7f5'
            '784e0ac535deb450455cbfa28a6f0df145ea1bb7ae51b821cf5e7927fdcfbdd0'
            '395ae124c09f9e6918a2310af6038fba074bcf474ac352496d5910dd59a2226d'
            'e672c95779cf947c5311f83787af4fa8fffd12fb27e4993211a84bdfd9610f9c'
            'e8189decb5ac0fa7bc8b96b7cb9b2701d60d48805aca84a238004d665fcc4008'
            'af4e37e9ea4401fc841ff54b9ddfc9be1079b1e89434c1a6a865dd68980f7e9f'
            '89daebc3e6fd160ac4aa9fc8b3bf71e1f74fbf92367ae71fb83a037e8bf164b9'
            'adb9e6ca4f869e1180728b7950e35922a7fc6397f7b641499e8f3ef06e50dc83'
            '9c8d87e72b64a3b4db28d11ce29237c246188f4f51057d65a7eab63b7987e423'
            '5c839a674fcd7a98952e593242ea400abe93992746761e38641405d28b00f419'
            'ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6'
            '712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f'
            '2b38e32f0abccf9987a4e3079dfb67dcd799fb61361e53e2882c3cbaf0d905d8'
            '32a4622180e7a0ec044bb555404c800bc9fd9ec262ec147edd5989ccd0c02cd3'
            'dc35310971f3b2dbbf3f0690a219f40e2d9afcf64f9ab7cc1be722937c26b4bc'
            '09ec2a7bb152e2252b53fa7803150007879548bc709c039df7627cabbd05d469'
            'a75915e7def60c94dcef72200b9a8e58e5091744960da64ec734a6c6e9b3743e'
            '8e9b5ad5ab802e97eb8e295ac6720e509ee4c243f69d781394014ebfe8bbfa0b'
            '0eee52d38c090b3caa76c563b86c3a4bd71ef1a819287c19d586d7334ae8ed66'
            '8f55c233f70c4b27f66c523580f78f1004e8b5a8b659e05a4eb49d4166cca406'
            '240948bc05c5e7c6dabba28bf89d89ffce3e303022809e73deaefe4f6ec56c66'
            '677d2418bec65e3338edb076e806bc1ec15693c5d0104683f2efe857f61056a9'
            '282be5f36a8ce781fad8c8ae18fa3f9beff57ec1b52cb3de0789201425d9a33d'
            '1e38bc4d79ed67fd075bcc251a1c39b32a1776bbe92e5bef1f0bf1f8c531853b'
            '9a2fa6e2155d7247be68c096456083145c183cbbbc2764150dda45a87197940c'
            '9b724f72796e036ab90c1021d4780d4d3d648aca59e491e6b98e725b84e99973'
            '53d40abd2583d23e4718fddf1ebec84dbff8381c07cae67ff7768bbf19c6718e'
            '147a5c80aabfbf0c7d901cb5895d1de30ef2907eb21fbbab29ca94c5b08b1a78'
            '0b7b52767868a23d5bab768e390dc5f5c55825b6d30b86c844ff2dc7414044cc'
            '24d5b23dc417412679681396f2b49f3de8c1473deb516bd34410872eff51ed0d'
            'ed94fce61571a4006852b7389a063ab983c02eb1bb37b47f8272ce92d06d9538'
            '589f6da84c646204747d1270a2a5661ea66ed1cced2631d546fdfb155959f9ec'
            'c8d71a593cc5c42ad7876e2c1fda56f314f3754c084128833e64f1345ff8a03a'
            '213b7324336b53d2414b2db8537e56544d981803139155afa84f76eeebb7a546'
            'ec1cdab258fb55c0da61328dc52c8764709b249011b2cad0454c72f0bf10a1f6'
            '192a0d989036cd60a1e91a54c9851fb9ad5bd96125d41803eed79d2e2ef74bd7'
            '3685b5c81fce630efc3e143a4ded235b107f1b1cdf186c3f115529e5e5ae4265'
            '519629a3f80976d89c575895b05677cbc45eaf9f70d62a364d819ba646409cc8'
            '589e9a02bfafb9754bb2340a9e3b38f389772684c63d9637e76b1870377bec29'
            '55e6b9b5f1361de2d5e7d9fd1ee5f6f7fcb6060618a1f82f3472f58f2b8d4be9'
            '573a8dd76961957108b10f7a45bac6ab1ea3e9b7fe01aff88325dc57bb8f5c8b'
            'ddd46446ea2a1f353bfda53e35f17633afa79f4fe290a611c94645c69fe96a50')
replaces=('ds-inhibit')

prepare() {
	export RUSTUP_TOOLCHAIN=stable
	cd "$srcdir"

	holo-vendor-rust-sources -o vendored -L "$pkgname-$pkgver/Cargo.lock" *.tar.gz

	cd "$pkgname-$pkgver"

	mkdir -pv .cargo

	cat << EOF >> .cargo/config.toml
	[source."crates-io"]
	replace-with = "vendored-sources"

	[source.vendored-sources]
	directory = "${srcdir}/vendored"
EOF
}

build() {
	cd "$pkgname-$pkgver"
	cargo build -r
}

package () {
	cd "$pkgname-$pkgver"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/services/"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/system-services/"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/system.d/"
	install -d -m0755 "$pkgdir/usr/lib/systemd/system/"
	install -d -m0755 "$pkgdir/usr/lib/systemd/user/gamescope-session.service.wants/"

	install -Ds -m755 "target/release/steamos-manager" "$pkgdir/usr/lib/steamos-manager"
	install -D -m755 "target/release/steamosctl" "$pkgdir/usr/bin/steamosctl"
	install -D -m644 -t "$pkgdir/usr/share/steamos-manager/platforms" "data/platforms/"*
	install -D -m644 LICENSE "$pkgdir/usr/share/licenses/$pkgname"

	install -m644 "data/system/com.steampowered.SteamOSManager1.service" "$pkgdir/usr/share/dbus-1/system-services/"
	install -m644 "data/system/com.steampowered.SteamOSManager1.conf" "$pkgdir/usr/share/dbus-1/system.d/"
	install -m644 "data/system/steamos-manager.service" "$pkgdir/usr/lib/systemd/system/"

	install -m644 "data/user/com.steampowered.SteamOSManager1.service" "$pkgdir/usr/share/dbus-1/services/"
	install -m644 "data/user/steamos-manager.service" "$pkgdir/usr/lib/systemd/user/"

	ln -s ../steamos-manager.service "$pkgdir/usr/lib/systemd/user/gamescope-session.service.wants/"
}

check() {
	cd "$pkgname-$pkgver"
	dbus-run-session cargo test
}
