# Maintainer: Vicki Pfau <vi@endrift.com>

pkgname=steamos-log-submitter
pkgver=0.6.1
pkgrel=2
pkgdesc="SteamOS Log Submitter"
url="https://github.com/evlav/steamos-log-submitter"
arch=('any')
license=('LGPL2.1')
source=("git+https://github.com/evlav/steamos-log-submitter.git#tag=$pkgver")
sha256sums=('SKIP')
depends=('python>=3.12' 'python<3.13' 'python-dbus-next' 'python-httpx' 'python-psutil' 'python-pyalsa' 'python-pyelftools' 'systemd' 'google-breakpad')
makedepends=('git' 'python-setuptools' 'python-wheel' 'python-pip')
checkdepends=('python-pytest' 'python-pytest-asyncio')
conflicts=('breakpad-hook')

package() {
	cd steamos-log-submitter
	make install DESTDIR="$pkgdir"
	pip install --root "$pkgdir" ./
}

check() {
	cd steamos-log-submitter
	dbus-run-session pytest
}
